"use strict";affiliatewp.attach("licenseActivator",{data:{},modal:function(title,content,icon,buttons,args){return jQuery.alert(jQuery.extend({backgroundDismiss:!0,title:title,icon:icon,type:"green",content:content,boxWidth:400,useBootstrap:!1,theme:"modern,affiliatewp-education",closeIcon:!0,draggable:!1,dragWindowBorder:!1,buttons:buttons},args))},init:function(){document.addEventListener("DOMContentLoaded",function(){var buttons=document.querySelectorAll(".affwp-settings-license-activator__button"),modalButtonArgs={confirm:{text:"OK",btnClass:"btn-confirm",keys:["enter"]}};buttons.forEach(function(button){button.addEventListener("click",function(){var _targetInput$value,_button$dataset$setti,_button$dataset$isAct,_affiliatewp$licenseA,_button$parentElement,targetInput=document.querySelector('input[name="'.concat(button.dataset.target,'"]')),key=null!==(_targetInput$value=targetInput.value)&&void 0!==_targetInput$value?_targetInput$value:"";if(""===key)return void affiliatewp.licenseActivator.modal("",button.dataset.invalidMessage,"fa fa-info-circle",modalButtonArgs,{closeIcon:!1,type:"orange"});var settingsToWatch=JSON.parse(null!==(_button$dataset$setti=button.dataset.settingsToWatch)&&void 0!==_button$dataset$setti?_button$dataset$setti:[]),additionalData={};settingsToWatch.forEach(function(settingName){var settingInput=document.querySelector('[name="affwp_settings['.concat(settingName,']"]'));settingInput&&(additionalData[settingName]=settingInput.value)});var isActivated=parseInt(null!==(_button$dataset$isAct=button.dataset.isActivated)&&void 0!==_button$dataset$isAct?_button$dataset$isAct:0),data={action:isActivated?button.dataset.deactivateAjaxAction:button.dataset.activateAjaxAction,key:key,nonce:null!==(_affiliatewp$licenseA=affiliatewp.licenseActivator.data.nonce)&&void 0!==_affiliatewp$licenseA?_affiliatewp$licenseA:""};for(var _key in additionalData)additionalData.hasOwnProperty(_key)&&(data["additional_data[".concat(_key,"]")]=additionalData[_key]);button.classList.add("affwp-button--is-loading");var container=null===button||void 0===button||null===(_button$parentElement=button.parentElement)||void 0===_button$parentElement?void 0:_button$parentElement.parentElement,statusEl=container.querySelector(".affwp-settings-license-activator__status");fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams(data).toString()}).then(function(response){if(button.classList.remove("affwp-button--is-loading"),!response.ok)throw new Error("Unknown. Please try again.");return response.json()}).then(function(result){if(!isActivated&&result.success)isActivated=1,targetInput.disabled=!0,button.textContent=button.dataset.labelActivated,affiliatewp.licenseActivator.modal("",button.dataset.activationMessage,"fa fa-check-circle",modalButtonArgs,{closeIcon:!1});else if(isActivated||result.success)isActivated&&result.success?(isActivated=0,targetInput.disabled=!1,button.textContent=button.dataset.labelDeactivated,affiliatewp.licenseActivator.modal("",button.dataset.deactivationMessage,"fa fa-info-circle",modalButtonArgs,{closeIcon:!1,type:"blue"})):isActivated&&!result.success&&affiliatewp.licenseActivator.modal("",button.dataset.deactivationErrorMessage,"fa fa-info-circle",modalButtonArgs,{closeIcon:!1,type:"red"});else{var _result$data$errorMes;affiliatewp.licenseActivator.modal("",null!==(_result$data$errorMes=null===result||void 0===result?void 0:result.data.errorMessage)&&void 0!==_result$data$errorMes?_result$data$errorMes:button.dataset.activationErrorMessage,"fa fa-info-circle",modalButtonArgs,{closeIcon:!1,type:"red"})}if(statusEl){var _result$data$status,_result$data;statusEl.innerHTML=null!==(_result$data$status=null===result||void 0===result||null===(_result$data=result.data)||void 0===_result$data?void 0:_result$data.status)&&void 0!==_result$data$status?_result$data$status:""}button.setAttribute("data-is-activated",isActivated),button.dispatchEvent(new CustomEvent("affwpOnLicenseActivatorEnd",{detail:{isActivated:isActivated,success:!0,container:container}}))}).catch(function(error){error&&affiliatewp.licenseActivator.modal("",error,"fa fa-info-circle",modalButtonArgs,{closeIcon:!1,type:"red"})})})})})}});